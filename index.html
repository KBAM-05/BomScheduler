<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ì•„ì´ ë§ì¶¤ ì£¼ê°„ ìŠ¤ì¼€ì¤„ëŸ¬</title>
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- Chosen Palette: Soothing Harmony -->
    <!-- Application Structure Plan: ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë³µì¡í•œ ì£¼ê°„ ìŠ¤ì¼€ì¤„ì„ ì‚¬ìš©ìê°€ ì‰½ê²Œ ì†Œí™”í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ì¸ êµ¬ì¡°ëŠ” 'ìš”ì¼ë³„ íƒ­' ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬, ì‚¬ìš©ìê°€ íŠ¹ì • ìš”ì¼ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ì¼ì˜ ìƒì„¸ ì¼ì •ì„ ì¦‰ì‹œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë°©ì‹ì€ ê¸´ í…ìŠ¤íŠ¸ ë¬¸ì„œë¥¼ ìŠ¤í¬ë¡¤í•˜ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ë¹ ë¥´ê³  ì§ê´€ì ì¸ íƒìƒ‰ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤. ì¼ì •ì€ ì‹œê°ì  íƒ€ì„ë¼ì¸ í˜•íƒœë¡œ í‘œì‹œë˜ë©°, ê° í™œë™ì€ ì•„ì´ì½˜ê³¼ ìƒ‰ìƒìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ ê°€ë…ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤. ë˜í•œ, ì£¼ê°„ ì „ì²´ì˜ í™œë™(ì¹˜ë£Œ, í•™ìŠµ, ë†€ì´ ë“±) ë¶„í¬ë¥¼ ë³´ì—¬ì£¼ëŠ” ë™ì  'ë§‰ëŒ€ ì°¨íŠ¸'ë¥¼ ì¶”ê°€í•˜ì—¬, ë¶€ëª¨ë‹˜ì´ ìŠ¤ì¼€ì¤„ì˜ ê· í˜•ì„ í•œëˆˆì— ë¶„ì„í•˜ê³  ì´í•´í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ì— 'ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„ íƒìƒ‰' ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ìš”ì¼ì˜ ì¼ì •ì„ ë³„ë„ë¡œ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•˜ê³ , 'í™œë™ ë¶„ì„' ì„¹ì…˜ì—ì„œëŠ” ì£¼ê°„ ë° ì¼ê°„ í™œë™ ë¶„ì„ íƒ­ì„ í†µí•´ ê°ê° ë§‰ëŒ€ ì°¨íŠ¸ë¡œ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ë©°, ì£¼ê°„ ë¶„ì„ ì‹œ ì¹­ì°¬ ìŠ¤í‹°ì»¤ ë³´ìƒë„ í•¨ê»˜ í‘œì‹œí•©ë‹ˆë‹¤. ì´ êµ¬ì¡°ëŠ” ì •ì  ì •ë³´ë¥¼ ë™ì ì´ê³  ë¶„ì„ì ì¸ ëŒ€ì‹œë³´ë“œë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©ì„±ì„ ê·¹ëŒ€í™”í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. -->
    <!-- Visualization & Content Choices: 
        - ì •ë³´: ìš”ì¼ë³„ ìƒì„¸ ìŠ¤ì¼€ì¤„ (ì‹¤ì‹œê°„) -> ëª©í‘œ: í˜„ì¬ ì§„í–‰ ìƒí™© ì•ˆë‚´ -> í‘œí˜„ ë°©ì‹: ì•„ì´ì½˜ í¬í•¨ ìˆ˜ì§ íƒ€ì„ë¼ì¸, ì‹¤ì‹œê°„ í•˜ì´ë¼ì´íŠ¸ -> ìƒí˜¸ì‘ìš©: ì²´í¬ë°•ìŠ¤ ì™„ë£Œ (í­ì£½, ë°•ìˆ˜ ì†Œë¦¬) -> ì •ë‹¹ì„±: ì‹¤ì‹œê°„ ë™ê¸° ë¶€ì—¬ ë° ì¦‰ê°ì ì¸ í”¼ë“œë°±.
        - ì •ë³´: ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„ íƒìƒ‰ (ì„ íƒì ) -> ëª©í‘œ: íŠ¹ì • ìš”ì¼ ì¼ì • í™•ì¸ -> í‘œí˜„ ë°©ì‹: ìš”ì¼ íƒ­ + ì•„ì´ì½˜ í¬í•¨ ìˆ˜ì§ íƒ€ì„ë¼ì¸ -> ìƒí˜¸ì‘ìš©: ìš”ì¼ íƒ­ í´ë¦­ -> ì •ë‹¹ì„±: ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë‚ ì˜ ìŠ¤ì¼€ì¤„ì„ í¸ë¦¬í•˜ê²Œ íƒìƒ‰.
        - ì •ë³´: ì£¼ê°„ í™œë™ ë¶„ì„ -> ëª©í‘œ: ì£¼ê°„ í™œë™ ë¶„í¬ íŒŒì•…, ì„±ê³¼ ì¸¡ì • -> í‘œí˜„ ë°©ì‹: ë§‰ëŒ€ ì°¨íŠ¸ (Canvas) + ì¹­ì°¬ ìŠ¤í‹°ì»¤ ê°œìˆ˜ -> ìƒí˜¸ì‘ìš©: 'ì£¼ê°„ í™œë™ ë¶„ì„' íƒ­ í´ë¦­ -> ì •ë‹¹ì„±: ì£¼ê°„ í™œë™ ìœ í˜•ë³„ ì‹œê°„ ë°°ë¶„ ë° ì„±ì·¨ë„ ì‹œê°í™”, ë³´ìƒ ì‹œìŠ¤í…œ í†µí•©.
        - ì •ë³´: ì¼ê°„ í™œë™ ë¶„ì„ -> ëª©í‘œ: íŠ¹ì • ì¼ì˜ í™œë™ êµ¬ì„± ì´í•´ -> í‘œí˜„ ë°©ì‹: ë§‰ëŒ€ ì°¨íŠ¸ (Canvas) -> ìƒí˜¸ì‘ìš©: 'ì¼ê°„ í™œë™ ë¶„ì„' íƒ­ í´ë¦­, 'ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„ íƒìƒ‰' ìš”ì¼ ì„ íƒ ì‹œ ì—…ë°ì´íŠ¸ -> ì •ë‹¹ì„±: ì¼ë³„ ìŠ¤ì¼€ì¤„ì˜ ê· í˜•ì„ ìƒì„¸í•˜ê²Œ íŒŒì•….
        - ì •ë³´: ìŠ¤ì¼€ì¤„ ìš´ì˜ ì°¸ê³ ì‚¬í•­ -> ëª©í‘œ: ê°€ì´ë“œë¼ì¸ ì œê³µ -> í‘œí˜„ ë°©ì‹: ì•„ì´ì½˜ í¬í•¨ ëª©ë¡ í…ìŠ¤íŠ¸ -> ìƒí˜¸ì‘ìš©: ì—†ìŒ -> ì •ë‹¹ì„±: í•µì‹¬ ì¡°ì–¸ì„ ëª…í™•í•˜ê³  ì½ê¸° ì‰½ê²Œ ì „ë‹¬.
        - ë¼ì´ë¸ŒëŸ¬ë¦¬: Tailwind CSS, Chart.js, Vanilla JS, Tone.js. SVG/Mermaid JSëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Chart height for bar charts */
            max-height: 400px;
        }
        .timeline-item {
            position: relative;
            padding-left: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 1.25rem;
            top: 1.25rem;
            bottom: -1.25rem;
            width: 2px;
            background-color: #EAEAEA;
            transform: translateX(-50%);
        }
        .timeline-item:last-child::before {
            display: none;
        }
        .tab-active {
            background-color: #A4C3B2;
            color: white;
            font-weight: 700;
        }
        .tab-inactive {
            background-color: #F0F0F0;
            color: #6B7280;
        }
        .analysis-tab-active {
            background-color: #5F9EA0; /* Darker teal for analysis tabs */
            color: white;
            font-weight: 700;
        }
        .analysis-tab-inactive {
            background-color: #E0F2F7; /* Lighter blue for inactive analysis tabs */
            color: #3B666B;
        }
        .current-activity {
            background-color: #FFFBEB; /* ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½ìœ¼ë¡œ ê°•ì¡° */
            border-left-color: #F59E0B; /* ê°•ì¡° í…Œë‘ë¦¬ ìƒ‰ìƒ */
        }
        .completed-activity .activity-text {
            text-decoration: line-through;
            color: #9CA3AF;
        }
        #fireworksCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            pointer-events: none; /* í´ë¦­ ì´ë²¤íŠ¸ í†µê³¼ */
        }
        .activity-checkbox {
            min-width: 20px;
            min-height: 20px;
        }

        /* ì˜¤ëŠ˜ì˜ ì¼ì • ì„¹ì…˜ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ê²Œ ì¶”ê°€ */
        #schedule-content {
            max-height: 500px; /* ì ì ˆí•œ ë†’ì´ ì„¤ì • (ì¡°ì ˆ ê°€ëŠ¥) */
            overflow-y: auto;
            padding-right: 10px; /* ìŠ¤í¬ë¡¤ë°”ê°€ ë‚´ìš© ê°€ë¦¬ì§€ ì•Šë„ë¡ íŒ¨ë”© ì¶”ê°€ */
        }
    </style>
</head>
<body class="antialiased">

    <canvas id="fireworksCanvas"></canvas>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-[#3B666B] mb-2">ìš°ë¦¬ì•„ì´ ë§ì¶¤ ì£¼ê°„ ìŠ¤ì¼€ì¤„ëŸ¬</h1>
            <p class="text-lg text-gray-600">ì•„ì´ì˜ í•˜ë£¨ë¥¼ ì‚¬ë‘ê³¼ ê³„íšìœ¼ë¡œ ì±„ì›Œì£¼ì„¸ìš”</p>
        </header>

        <main>
            <div class="lg:grid lg:grid-cols-3 lg:gap-8">
                
                <div class="lg:col-span-2">
                    <section id="daily-schedule" class="bg-white p-6 rounded-2xl shadow-lg mb-8">
                        <h2 class="text-2xl font-bold mb-4 text-[#3B666B]">ì˜¤ëŠ˜ì˜ ì¼ì •</h2>
                        <p class="text-gray-600 mb-6">í˜„ì¬ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ëŠ˜ í•´ì•¼ í•  í™œë™ì„ í™•ì¸í•˜ê³ , ì™„ë£Œ ì‹œ ì²´í¬ë°•ìŠ¤ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!</p>
                        <!-- 'ì˜¤ëŠ˜ì˜ ì¼ì •'ì„ ìœ„í•œ ìš”ì¼ íƒ­ ì¶”ê°€ -->
                        <div id="day-tabs" class="flex flex-wrap gap-2 mb-6">
                            <!-- Day tabs for 'ì˜¤ëŠ˜ì˜ ì¼ì •' will be rendered here -->
                        </div>
                        <div id="schedule-content" class="space-y-6">
                            <!-- Today's dynamic schedule will be rendered here -->
                        </div>
                    </section>

                    <!-- í™œë™ ë¶„ì„ íƒ­ì„ 'ì˜¤ëŠ˜ì˜ ì¼ì •' ì„¹ì…˜ ë°”ë¡œ ì•„ë˜ë¡œ ì´ë™ -->
                    <section id="analysis-section" class="bg-white p-6 rounded-2xl shadow-lg h-full">
                        <h2 class="text-2xl font-bold mb-4 text-[#3B666B]">í™œë™ ë¶„ì„</h2>
                        <div class="flex gap-2 mb-4">
                            <button id="weekly-analysis-tab" class="px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 analysis-tab-active">ì£¼ê°„ í™œë™ ë¶„ì„</button>
                            <button id="daily-analysis-tab" class="px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 analysis-tab-inactive">ì¼ê°„ í™œë™ ë¶„ì„</button>
                        </div>

                        <div id="weekly-analysis-content" class="analysis-content">
                            <p class="text-gray-600 mb-4 text-sm">ì´ë²ˆ ì£¼ í™œë™ë“¤ì´ ì–¼ë§ˆë‚˜ ê· í˜•ìˆê²Œ ë¶„í¬ë˜ì–´ ìˆëŠ”ì§€ ë§‰ëŒ€ ê·¸ë˜í”„ë¡œ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                            <div class="chart-container mb-4">
                                <canvas id="weeklyActivityChart"></canvas>
                            </div>
                            <div class="text-center bg-[#E0F2F7] p-3 rounded-lg border border-[#A4C3B2]">
                                <p class="text-lg font-bold text-[#3B666B]">ì´ <span id="total-activities-count-weekly">0</span>ê°œ í™œë™ ì¤‘ <span id="completed-activities-count-weekly">0</span>ê°œ ì™„ë£Œ!</p>
                                <p class="text-2xl font-extrabold text-[#F59E0B]">ì´ë²ˆ ì£¼ ì¹­ì°¬ ìŠ¤í‹°ì»¤: <span id="sticker-count-weekly" class="text-4xl">0</span>ê°œ ğŸ‰</p>
                            </div>
                        </div>

                        <div id="daily-analysis-content" class="analysis-content hidden">
                            <p class="text-gray-600 mb-4 text-sm"><span id="daily-analysis-day-desc">ì„ íƒëœ ìš”ì¼</span> í™œë™ë“¤ì˜ êµ¬ì„± ë¹„ìœ¨ì„ í¼ì„¼íŠ¸ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                            <div class="chart-container">
                                <canvas id="dailyActivityChart"></canvas>
                            </div>
                        </div>
                    </section>
                </div>
                
                <div class="lg:col-span-1 mt-8 lg:mt-0">
                    <section id="explore-schedule-section" class="bg-white p-6 rounded-2xl shadow-lg mb-8">
                        <h2 class="text-2xl font-bold mb-4 text-[#3B666B]">ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„ íƒìƒ‰</h2>
                        <p class="text-gray-600 mb-4 text-sm">ì›í•˜ëŠ” ìš”ì¼ì„ ì„ íƒí•˜ì—¬ í•´ë‹¹ì¼ì˜ ìƒì„¸ ìŠ¤ì¼€ì¤„ì„ ë¯¸ë¦¬ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                        <div id="explore-day-tabs" class="flex flex-wrap gap-2 mb-6">
                            <!-- Explore day tabs will be rendered here -->
                        </div>
                        <div id="schedule-content-explore" class="space-y-4">
                            <!-- Selected day's schedule will be rendered here -->
                        </div>
                    </section>
                </div>

            </div>
            
            <!-- ìŠ¤ì¼€ì¤„ ìš´ì˜ Tip ì„¹ì…˜ ì œê±°ë¨ -->
        </main>

    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded! (DOM ë‚´ìš© ë¡œë“œ ì™„ë£Œ)'); // Debug 1

            let scheduleData = {
                'ì›”': [
                    { time: 'ì˜¤í›„ 5:00', activity: 'ì§‘ ë„ì°©, íœ´ì‹ ë° ììœ  ë†€ì´', description: 'ê°„ì‹ì„ ë¨¹ê³ , ì•„ì´ê°€ ì›í•˜ëŠ” ë†€ì´ë¥¼ í•˜ë©° í¸ì•ˆí•œ ì‹œê°„ì„ ë³´ë‚´ìš”.', category: 'íœ´ì‹', icon: 'ğŸ ', completed: false },
                    { time: 'ì˜¤í›„ 6:00', activity: '1:1 í•™ìŠµ/í›ˆë ¨ (30ë¶„)', description: 'í•™êµ ìˆ™ì œë¥¼ ë³µìŠµí•˜ê±°ë‚˜, ì¦ê±°ìš´ ë†€ì´ì²˜ëŸ¼ ê°œë³„ í•™ìŠµì„ ì§„í–‰í•´ìš”.', category: 'í•™ìŠµ', icon: 'ğŸ“š', completed: false },
                    { time: 'ì˜¤í›„ 6:30', activity: 'ì €ë… ì‹ì‚¬', description: 'ì˜¨ ê°€ì¡±ì´ í•¨ê»˜ ì¦ê±°ìš´ ì‹ì‚¬ ì‹œê°„ì„ ê°€ì ¸ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ğŸ½ï¸', completed: false },
                    { time: 'ì˜¤í›„ 7:30', activity: 'í•¨ê»˜ ì±… ì½ê¸°', description: 'ì•„ì´ì˜ ìƒìƒë ¥ì„ ìê·¹í•˜ëŠ” ì¬ë¯¸ìˆëŠ” ì±…ì„ í•¨ê»˜ ì½ì–´ìš”.', category: 'ë…ì„œ', icon: 'ğŸ“–', completed: false },
                    { time: 'ì˜¤í›„ 8:00', activity: 'ììœ  ë†€ì´ ë° íœ´ì‹', description: 'ì•„ì´ê°€ ì¢‹ì•„í•˜ëŠ” í™œë™ìœ¼ë¡œ í•˜ë£¨ë¥¼ ì¦ê²ê²Œ ë§ˆë¬´ë¦¬í•´ìš”.', category: 'ë†€ì´', icon: 'ğŸ‰', completed: false },
                    { time: 'ì˜¤í›„ 9:30', activity: 'ì·¨ì¹¨ ì¤€ë¹„', description: 'ë‚´ì¼ì„ ìœ„í•´ ì°¨ë¶„í•˜ê²Œ ì ìë¦¬ì— ë“¤ ì¤€ë¹„ë¥¼ í•´ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ì”»ê¸°', completed: false },
                ],
                'í™”': [
                    { time: 'ì˜¤í›„ 5:00', activity: 'ì§‘ ë„ì°©, íœ´ì‹ ë° ììœ  ë†€ì´', description: 'í•™êµ ë‹¤ë…€ì˜¨ í›„ ì¶©ë¶„íˆ ì‰¬ëŠ” ì‹œê°„ì„ ê°€ì ¸ìš”.', category: 'íœ´ì‹', icon: 'ğŸ ', completed: false },
                    { time: 'ì˜¤í›„ 6:30', activity: 'ì €ë… ì‹ì‚¬', description: 'ë§›ìˆëŠ” ì €ë…ì„ ë¨¹ìœ¼ë©° ë„ë€ë„ë€ ì´ì•¼ê¸°í•´ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ğŸ½ï¸', completed: false },
                    { time: 'ì˜¤í›„ 7:30', activity: 'í•œê¸€/ìˆ˜í•™ ìˆ˜ì—… (ì™¸ë¶€)', description: 'ì™¸ë¶€ ìˆ˜ì—…ì— ì°¸ì—¬í•˜ë©° ìƒˆë¡œìš´ ê²ƒì„ ë°°ì›Œìš”.', category: 'ì™¸ë¶€ìˆ˜ì—…', icon: 'ğŸ«', completed: false },
                    { time: 'ì˜¤í›„ 8:30', activity: 'ìˆ˜ì—… í›„ íœ´ì‹ ë° ììœ  ë†€ì´', description: 'ìˆ˜ì—…ìœ¼ë¡œ ì§€ì¹œ ëª¸ê³¼ ë§ˆìŒì„ ì‰¬ê²Œ í•´ì¤˜ìš”.', category: 'ë†€ì´', icon: 'ğŸ‰', completed: false },
                    { time: 'ì˜¤í›„ 9:30', activity: 'ì·¨ì¹¨ ì¤€ë¹„', description: 'ë‚´ì¼ì„ ìœ„í•´ ì°¨ë¶„í•˜ê²Œ ì ìë¦¬ì— ë“¤ ì¤€ë¹„ë¥¼ í•´ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ì”»ê¸°', completed: false },
                ],
                'ìˆ˜': [
                    { time: 'ì˜¤í›„ 5:00', activity: 'í†µí•© ê°ê° ì¹˜ë£Œ (ì™¸ë¶€)', description: 'ì¹˜ë£Œë¥¼ í†µí•´ ë‹¤ì–‘í•œ ê°ê°ì„ ê²½í—˜í•˜ê³  ë°œë‹¬ì‹œì¼œìš”.', category: 'ì¹˜ë£Œ', icon: 'ğŸ§ ', completed: false },
                    { time: 'ì˜¤í›„ 6:30', activity: 'ì§‘ ë„ì°© ë° íœ´ì‹', description: 'ì¹˜ë£Œ í›„ ì§‘ì— ì™€ì„œ í¸ì•ˆí•˜ê²Œ ì‰¬ì–´ìš”.', category: 'íœ´ì‹', icon: 'ğŸ ', completed: false },
                    { time: 'ì˜¤í›„ 7:00', activity: 'ì €ë… ì‹ì‚¬', description: 'ì—ë„ˆì§€ë¥¼ ë³´ì¶©í•˜ëŠ” ì¦ê±°ìš´ ì €ë… ì‹œê°„ì´ì—ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ğŸ½ï¸', completed: false },
                    { time: 'ì˜¤í›„ 7:40', activity: '1:1 í•™ìŠµ/í›ˆë ¨ (30ë¶„)', description: 'ì§§ê³  ì¬ë¯¸ìˆê²Œ, ë†€ì´ì²˜ëŸ¼ í•™ìŠµ í™œë™ì„ í•´ìš”.', category: 'í•™ìŠµ', icon: 'ğŸ“š', completed: false },
                    { time: 'ì˜¤í›„ 8:10', activity: 'í•¨ê»˜ ì±… ì½ê¸° ë˜ëŠ” ê°€ë²¼ìš´ ë†€ì´', description: 'ì°¨ë¶„í•œ í™œë™ìœ¼ë¡œ í•˜ë£¨ë¥¼ ì •ë¦¬í•´ìš”.', category: 'ë…ì„œ', icon: 'ğŸ“–', completed: false },
                    { time: 'ì˜¤í›„ 9:30', activity: 'ì·¨ì¹¨ ì¤€ë¹„', description: 'ë‚´ì¼ì„ ìœ„í•´ ì°¨ë¶„í•˜ê²Œ ì ìë¦¬ì— ë“¤ ì¤€ë¹„ë¥¼ í•´ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ì”»ê¸°', completed: false },
                ],
                'ëª©': [
                    { time: 'ì˜¤í›„ 4:00', activity: 'ì¸ì§€ ì¹˜ë£Œ (ì™¸ë¶€)', description: 'ìƒê°í•˜ëŠ” í˜ì„ ê¸°ë¥´ëŠ” ì¦ê±°ìš´ ì¹˜ë£Œ ì‹œê°„ì´ì—ìš”.', category: 'ì¹˜ë£Œ', icon: 'ğŸ§ ', completed: false },
                    { time: 'ì˜¤í›„ 5:30', activity: 'ì§‘ ë„ì°© ë° íœ´ì‹', description: 'ì¹˜ë£Œ í›„ ì§‘ì— ì™€ì„œ í¸ì•ˆí•˜ê²Œ ì‰¬ì–´ìš”.', category: 'íœ´ì‹', icon: 'ğŸ ', completed: false },
                    { time: 'ì˜¤í›„ 6:30', activity: 'ì €ë… ì‹ì‚¬', description: 'ë§›ìˆëŠ” ì €ë…ìœ¼ë¡œ ì—ë„ˆì§€ë¥¼ ì±„ì›Œìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ğŸ½ï¸', completed: false },
                    { time: 'ì˜¤í›„ 7:30', activity: 'í•œê¸€/ìˆ˜í•™ ìˆ˜ì—… (ì™¸ë¶€)', description: 'ì™¸ë¶€ ìˆ˜ì—…ì„ í†µí•´ ì¦ê²ê²Œ ë°°ì›Œìš”.', category: 'ì™¸ë¶€ìˆ˜ì—…', icon: 'ğŸ«', completed: false },
                    { time: 'ì˜¤í›„ 8:30', activity: 'ììœ  ë†€ì´ ì‹œê°„', description: 'ì•„ì´ê°€ ì›í•˜ëŠ” ë†€ì´ë¥¼ í•˜ë©° ë§ˆìŒê» ìƒìƒë ¥ì„ í¼ì³ìš”.', category: 'ë†€ì´', icon: 'ğŸ‰', completed: false },
                    { time: 'ì˜¤í›„ 9:30', activity: 'ì·¨ì¹¨ ì¤€ë¹„', description: 'ë‚´ì¼ì„ ìœ„í•´ ì°¨ë¶„í•˜ê²Œ ì ìë¦¬ì— ë“¤ ì¤€ë¹„ë¥¼ í•´ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ì”»ê¸°', completed: false },
                ],
                'ê¸ˆ': [
                    { time: 'ì˜¤í›„ 5:00', activity: 'ì‚¬íšŒì„± ìˆ˜ì—… (ì™¸ë¶€)', description: 'ì¹œêµ¬ë“¤ê³¼ ì–´ìš¸ë¦¬ëŠ” ë°©ë²•ì„ ë°°ìš°ëŠ” ì‹œê°„ì´ì—ìš”.', category: 'ì¹˜ë£Œ', icon: 'ğŸ§‘â€ğŸ¤â€ğŸ§‘', completed: false },
                    { time: 'ì˜¤í›„ 6:00', activity: 'í‚¤ì¦ˆì¹´í˜ì—ì„œ ì‹ ë‚˜ê²Œ ë†€ê¸°', description: 'ì—ë„ˆì§€ë¥¼ ë°œì‚°í•˜ë©° ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ë‚´ìš”.', category: 'ë†€ì´', icon: 'ğŸ¤¸', completed: false },
                    { time: 'ì˜¤í›„ 7:30', activity: 'ì§‘ ë„ì°© ë° ì €ë… ì‹ì‚¬', description: 'ì‹ ë‚˜ê²Œ ë†€ê³  ì™€ì„œ ë¨¹ëŠ” ì €ë…ì€ ê¿€ë§›ì´ì—ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ğŸ½ï¸', completed: false },
                    { time: 'ì˜¤í›„ 8:30', activity: 'í•¨ê»˜ ì±… ì½ê¸° ë˜ëŠ” ê°€ë²¼ìš´ í™œë™', description: 'í¥ë¶„ëœ ë§ˆìŒì„ ê°€ë¼ì•‰íˆê³  ì°¨ë¶„í•˜ê²Œ í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í•´ìš”.', category: 'ë…ì„œ', icon: 'ğŸ“–', completed: false },
                    { time: 'ì˜¤í›„ 9:30', activity: 'ì·¨ì¹¨ ì¤€ë¹„', description: 'ë‚´ì¼ì„ ìœ„í•´ ì°¨ë¶„í•˜ê²Œ ì ìë¦¬ì— ë“¤ ì¤€ë¹„ë¥¼ í•´ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ì”»ê¸°', completed: false },
                ],
                'ì£¼ë§': [
                    { time: 'ì˜¤ì „ 9:00', activity: 'ê¸°ìƒ ë° ì•„ì¹¨ ì‹ì‚¬', description: 'ì£¼ë§ ì•„ì¹¨, ìƒì¾Œí•˜ê²Œ ì‹œì‘í•´ìš”!', category: 'ê¸°ë³¸ìƒí™œ', icon: 'â˜€ï¸', completed: false },
                    { time: 'ì˜¤ì „ 10:00', activity: 'ì§§ì€ 1:1 í•™ìŠµ (30-40ë¶„)', description: 'ì£¼ì¤‘ì— ë¶€ì¡±í–ˆë˜ ë¶€ë¶„ì„ ì¬ë¯¸ìˆëŠ” ë†€ì´ì²˜ëŸ¼ í•™ìŠµí•´ìš”.', category: 'í•™ìŠµ', icon: 'ğŸ“š', completed: false },
                    { time: 'ì˜¤ì „ 10:40', activity: 'í•¨ê»˜ ì±… ì½ê¸°', description: 'í¥ë¯¸ë¡œìš´ ì´ì•¼ê¸°ë¥¼ í•¨ê»˜ ì½ìœ¼ë©° ìƒìƒë ¥ì„ í‚¤ì›Œìš”.', category: 'ë…ì„œ', icon: 'ğŸ“–', completed: false },
                    { time: 'ì˜¤ì „ 11:30', activity: 'ììœ  ë†€ì´ ë˜ëŠ” ì•¼ì™¸ í™œë™', description: 'ì•„ì´ê°€ ì¢‹ì•„í•˜ëŠ” ë†€ì´ë¥¼ í•˜ê±°ë‚˜, ê°€ê¹Œìš´ ê³µì›ì—ì„œ ì‹ ì²´ í™œë™ì„ ì¦ê²¨ìš”.', category: 'ë†€ì´', icon: 'ğŸª', completed: false },
                    { time: 'ì˜¤í›„ 12:30', activity: 'ì ì‹¬ ì‹ì‚¬', description: 'ë§›ìˆëŠ” ì ì‹¬ì„ ë¨¹ê³  ì—ë„ˆì§€ë¥¼ ì¶©ì „í•´ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ğŸ½ï¸', completed: false },
                    { time: 'ì˜¤í›„ 2:00', activity: 'ë¶€ëª¨ë‹˜ê³¼ íŠ¹ë³„ í™œë™/ì¹˜ë£Œ í›ˆë ¨', description: 'ì•„ì´ì—ê²Œ í•„ìš”í•œ ë§ì¶¤í˜• í›ˆë ¨(ì†Œê·¼ìœ¡, ì¸ì§€, ì–¸ì–´ ë“±)ì„ ë†€ì´ì²˜ëŸ¼ ì§„í–‰í•˜ê±°ë‚˜, í•¨ê»˜ íŠ¹ë³„í•œ í™œë™ì„ í•´ìš”.', category: 'ì¹˜ë£Œ', icon: 'ğŸ§©', completed: false },
                    { time: 'ì˜¤í›„ 3:00', activity: 'ììœ  ë†€ì´ ë° ê°„ì‹', description: 'í™œë™ í›„ ììœ ë¡­ê²Œ ë†€ë©° ê°„ì‹ì„ ë¨¹ì–´ìš”.', category: 'ë†€ì´', icon: 'ğŸ¦', completed: false },
                    { time: 'ì˜¤í›„ 5:00', activity: 'ê°€ì¡±ê³¼ í•¨ê»˜í•˜ëŠ” ì‹œê°„', description: 'ë³´ë“œê²Œì„, ì˜í™” ë³´ê¸°, ëŒ€í™” ë“± ê°€ì¡±ê³¼ ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ë‚´ìš”.', category: 'ë†€ì´', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', completed: false },
                    { time: 'ì˜¤í›„ 6:30', activity: 'ì €ë… ì‹ì‚¬', description: 'ì£¼ë§ ì €ë…ì€ íŠ¹ë³„í•œ ë©”ë‰´ë¡œ ì¦ê²ê²Œ!', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ğŸœ', completed: false },
                    { time: 'ì˜¤í›„ 8:00', activity: 'íœ´ì‹ ë° ì·¨ì¹¨ ì¤€ë¹„', description: 'í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í•˜ë©° í¸ì•ˆí•˜ê²Œ ì‰¬ê³  ì ìë¦¬ì— ë“¤ ì¤€ë¹„ë¥¼ í•´ìš”.', category: 'ê¸°ë³¸ìƒí™œ', icon: 'ì”»ê¸°', completed: false }
                ]
            };
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìŠ¤ì¼€ì¤„ ë°ì´í„°ë¥¼ ë¡œë“œ
            function loadScheduleState() {
                const savedData = localStorage.getItem('childScheduleData');
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        if (Object.keys(parsedData).length > 0) { 
                            scheduleData = parsedData;
                            console.log('Local storageì—ì„œ ìŠ¤ì¼€ì¤„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', scheduleData); // Debug 2
                        } else {
                            console.log('Local storage ë°ì´í„°ê°€ ë¹„ì–´ìˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì•„ ê¸°ë³¸ ìŠ¤ì¼€ì¤„ ì‚¬ìš©.'); // Debug 3
                        }
                    } catch (e) {
                        console.error('Local storage ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e); // Debug 4
                        console.log('íŒŒì‹± ì˜¤ë¥˜ë¡œ ì¸í•´ ê¸°ë³¸ ìŠ¤ì¼€ì¤„ ì‚¬ìš©.');
                    }
                } else {
                    console.log('Local storageì— ìŠ¤ì¼€ì¤„ ë°ì´í„° ì—†ìŒ. ê¸°ë³¸ ìŠ¤ì¼€ì¤„ ì‚¬ìš©.'); // Debug 5
                }
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ìŠ¤ì¼€ì¤„ ë°ì´í„°ë¥¼ ì €ì¥
            function saveScheduleState() {
                localStorage.setItem('childScheduleData', JSON.stringify(scheduleData));
            }

            // 'ìŠ¤ì¼€ì¤„ ìš´ì˜ Tip' ë°ì´í„° ì œê±°ë¨

            const categoryColors = {
                'ì¹˜ë£Œ': '#FF7F50', // Coral
                'í•™ìŠµ': '#6495ED', // CornflowerBlue
                'ë…ì„œ': '#8A2BE2', // BlueViolet
                'ë†€ì´': '#3CB371', // MediumSeaGreen
                'íœ´ì‹': '#FFD700', // Gold
                'ê¸°ë³¸ìƒí™œ': '#A9A9A9', // DarkGray
                'ì™¸ë¶€ìˆ˜ì—…': '#DC143C' // Crimson
            };
            
            const categoryBorders = {
                'ì¹˜ë£Œ': 'border-orange-400',
                'í•™ìŠµ': 'border-blue-500',
                'ë…ì„œ': 'border-purple-500',
                'ë†€ì´': 'border-teal-500',
                'íœ´ì‹': 'border-yellow-400',
                'ê¸°ë³¸ìƒí™œ': 'border-gray-400',
                'ì™¸ë¶€ìˆ˜ì—…': 'border-red-400'
            };

            const scheduleContent = document.getElementById('schedule-content'); // Left panel schedule content area
            const exploreScheduleContent = document.getElementById('schedule-content-explore'); // Right panel explore schedule content area
            const dayTabsContainer = document.getElementById('day-tabs'); // Left panel day tabs container
            const exploreDayTabsContainer = document.getElementById('explore-day-tabs'); // Right panel explore day tabs container

            const weeklyAnalysisTab = document.getElementById('weekly-analysis-tab');
            const dailyAnalysisTab = document.getElementById('daily-analysis-tab');
            const weeklyAnalysisContent = document.getElementById('weekly-analysis-content');
            const dailyAnalysisContent = document.getElementById('daily-analysis-content');

            let weeklyActivityChart = null; // ì£¼ê°„ í™œë™ ë¶„ì„ ì°¨íŠ¸
            let dailyActivityChart = null; // ì¼ê°„ í™œë™ ë¶„ì„ ì°¨íŠ¸
            let currentActiveDay = 'ì›”'; // Default active day for left panel (today's schedule)
            let currentExploredDay = 'ì›”'; // Default explored day for right panel's schedule exploration and daily analysis
            let lastAnnouncedActivity = null;

            // Fireworks Canvas setup
            const fireworksCanvas = document.getElementById('fireworksCanvas');
            const fireworksCtx = fireworksCanvas.getContext('2d');
            let particles = [];

            function setCanvasSize() {
                fireworksCanvas.width = window.innerWidth;
                fireworksCanvas.height = window.innerHeight;
            }

            setCanvasSize();
            window.addEventListener('resize', setCanvasSize);

            function Particle(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocity = {
                    x: (Math.random() - 0.5) * 15, 
                    y: (Math.random() - 0.5) * 15
                };
                this.alpha = 1;
                this.friction = 0.97; 
                this.gravity = 0.05; 
                this.radius = Math.random() * 5 + 2; 
            }

            Particle.prototype.draw = function() {
                fireworksCtx.save();
                fireworksCtx.globalAlpha = this.alpha;
                fireworksCtx.beginPath();
                fireworksCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                fireworksCtx.fillStyle = this.color;
                fireworksCtx.fill();
                fireworksCtx.restore();
            };

            Particle.prototype.update = function() {
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.velocity.y += this.gravity;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= 0.015; 
                if (this.alpha < 0) this.alpha = 0;
                this.draw();
            };

            function createFireworks(x, y) {
                const colors = ['#FFD700', '#FF4500', '#ADFF2F', '#1E90FF', '#FF69B4', '#DAA520'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                const particleCount = 80 + Math.floor(Math.random() * 70); 

                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle(x, y, color));
                }
            }

            function animateFireworks() {
                requestAnimationFrame(animateFireworks);
                fireworksCtx.clearRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);

                for (let i = particles.length - 1; i >= 0; i--) {
                    particles[i].update();
                    if (particles[i].alpha <= 0.1) {
                        particles.splice(i, 1);
                    }
                }
            }
            animateFireworks();

            let clapSynth; 
            let reverb; 

            async function setupAudio() {
                if (Tone.context.state !== 'running') {
                    await Tone.start();
                }

                reverb = new Tone.Reverb({
                    decay: 3,      
                    preDelay: 0.02 
                }).toDestination(); 

                clapSynth = new Tone.NoiseSynth({
                    noise: {
                        type: "white"
                    },
                    envelope: {
                        attack: 0.01,   
                        decay: 0.8,     
                        sustain: 0.0,
                        release: 1.0    
                    }
                }).connect(reverb); 
            }

            function playClapSound() {
                if (!clapSynth || !reverb) {
                    setupAudio().then(() => {
                        if (clapSynth) clapSynth.triggerAttackRelease("2n"); 
                    });
                } else {
                    clapSynth.triggerAttackRelease("2n"); 
                }
            }

            function speak(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ko-KR';
                    window.speechSynthesis.speak(utterance);
                } else {
                    console.warn('Text-to-speech not supported in this browser.');
                }
            }

            function parseTime(timeStr) {
                const [ampm, time] = timeStr.split(' ');
                let [hours, minutes] = time.split(':').map(Number);
                if (ampm === 'ì˜¤í›„' && hours !== 12) {
                    hours += 12;
                } else if (ampm === 'ì˜¤ì „' && hours === 12) {
                    hours = 0;
                }
                return { hours, minutes };
            }

            function updateCurrentActivityHighlight() {
                const now = new Date();
                console.log('í˜„ì¬ ì‹œê°„:', now.toLocaleTimeString(), 'í˜„ì¬ ìš”ì¼ (ì‹œìŠ¤í…œ):', now.getDay()); // Debug: í˜„ì¬ ì‹œê°„ ë° ìš”ì¼ í™•ì¸

                const currentSystemDayIndex = now.getDay();
                const daysOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                let systemDeterminedDay = daysOfWeek[currentSystemDayIndex];

                if (currentSystemDayIndex === 0 || currentSystemDayIndex === 6) { 
                    systemDeterminedDay = 'ì£¼ë§';
                }

                console.log('ê²°ì •ëœ ì‹œìŠ¤í…œ ìš”ì¼:', systemDeterminedDay); // Debug: ê²°ì •ëœ ì‹œìŠ¤í…œ ìš”ì¼

                // í˜„ì¬ í™œì„±í™”ëœ ìš”ì¼ íƒ­ê³¼ ì‹œìŠ¤í…œ ìš”ì¼ì´ ë‹¤ë¥´ë©´ íƒ­ì„ ì „í™˜í•˜ê³  ìŠ¤ì¼€ì¤„ì„ ë‹¤ì‹œ ë Œë”ë§
                if (currentActiveDay !== systemDeterminedDay) {
                    console.log(`ìš”ì¼ ì „í™˜ ê°ì§€: ${currentActiveDay} -> ${systemDeterminedDay}`); // Debug: ìš”ì¼ ì „í™˜ ê°ì§€
                    const tabButtons = document.querySelectorAll('#day-tabs button');
                    let targetTabButton = null;

                    tabButtons.forEach(button => {
                        if (button.textContent === systemDeterminedDay) {
                            targetTabButton = button;
                        }
                    });

                    if (targetTabButton) {
                        tabButtons.forEach(btn => btn.classList.replace('tab-active', 'tab-inactive'));
                        targetTabButton.classList.replace('tab-inactive', 'tab-active');
                        currentActiveDay = systemDeterminedDay; 
                        renderSchedule(currentActiveDay); // ìƒˆ í™œì„± ìš”ì¼ì— ëŒ€í•œ ìŠ¤ì¼€ì¤„ ë‹¤ì‹œ ë Œë”ë§
                        console.log('ìš”ì¼ íƒ­ ì „í™˜ ë° ìŠ¤ì¼€ì¤„ ë Œë”ë§ ì™„ë£Œ.'); // Debug: ìš”ì¼ íƒ­ ì „í™˜ í™•ì¸
                    } else {
                        console.warn('ì‹œìŠ¤í…œ ìš”ì¼ì— í•´ë‹¹í•˜ëŠ” íƒ­ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', systemDeterminedDay); // Debug: íƒ­ ë²„íŠ¼ ì—†ìŒ ê²½ê³ 
                    }
                }

                const currentSchedule = scheduleData[currentActiveDay];
                if (!currentSchedule) {
                     lastAnnouncedActivity = null;
                     console.log('í˜„ì¬ ìš”ì¼ì— ëŒ€í•œ ìŠ¤ì¼€ì¤„ ë°ì´í„°ê°€ ì—†ìŒ.'); // Debug: ìŠ¤ì¼€ì¤„ ë°ì´í„° ì—†ìŒ
                     return;
                }

                // ëª¨ë“  í™œë™ì—ì„œ ê°•ì¡° í‘œì‹œ ì œê±°
                document.querySelectorAll('#schedule-content .timeline-item').forEach(item => {
                    item.classList.remove('current-activity');
                });

                let foundCurrent = false;
                let currentActivityIndex = -1;

                for (let i = 0; i < currentSchedule.length; i++) {
                    const item = currentSchedule[i];
                    if (item.completed) continue; // ì™„ë£Œëœ í™œë™ì€ ê°•ì¡°ì—ì„œ ì œì™¸

                    let startTimeHours, startTimeMinutes;
                    // í˜„ì¬ í™œë™ì˜ ì‹œê°„ íŒŒì‹±
                    if (item.time.includes('ì˜¤ì „') || item.time.includes('ì˜¤í›„')) {
                        const parsed = parseTime(item.time);
                        startTimeHours = parsed.hours;
                        startTimeMinutes = parsed.minutes;
                    } else {
                        // íŠ¹ì • ì‹œê°„ì´ ì—†ëŠ” í™œë™ì˜ ê²½ìš° í˜„ì¬ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì„ì‹œ ì‹œê°„ í• ë‹¹ (ì£¼ë§ì€ ìë™ ê°•ì¡°í•˜ì§€ ì•ŠìŒ)
                        if (currentActiveDay === 'ì£¼ë§') {
                            continue; // ì£¼ë§ íŠ¹ì • ì‹œê°„ ì—†ëŠ” í™œë™ì€ ìë™ ê°•ì¡° ì•ˆí•¨
                        }
                        startTimeHours = now.getHours(); 
                        startTimeMinutes = now.getMinutes(); 
                    }

                    const startDateTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), startTimeHours, startTimeMinutes);

                    let endDateTime;
                    if (i + 1 < currentSchedule.length) {
                        // ë‹¤ìŒ í™œë™ì˜ ì‹œì‘ ì‹œê°„ì´ í˜„ì¬ í™œë™ì˜ ì¢…ë£Œ ì‹œê°„
                        const nextItem = currentSchedule[i+1];
                        if (nextItem.time.includes('ì˜¤ì „') || nextItem.time.includes('ì˜¤í›„')) {
                            const nextStartTime = parseTime(nextItem.time);
                            endDateTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), nextStartTime.hours, nextStartTime.minutes);
                        } else {
                            // ë‹¤ìŒ í™œë™ì— íŠ¹ì • ì‹œê°„ì´ ì—†ìœ¼ë©´ í˜„ì¬ í™œë™ì€ 1ì‹œê°„ ì§€ì†ëœë‹¤ê³  ê°€ì •
                            endDateTime = new Date(startDateTime.getTime() + 60 * 60 * 1000); 
                        }
                    } else {
                        // ì˜¤ëŠ˜ì˜ ë§ˆì§€ë§‰ í™œë™: ë°¤ 10ì‹œ (ì·¨ì¹¨ ì‹œê°„)ê¹Œì§€ ë˜ëŠ” ìµœì†Œ 1ì‹œê°„ ì§€ì†ëœë‹¤ê³  ê°€ì •
                        if (currentActiveDay === 'ì£¼ë§') {
                             const endOfDayTime = parseTime('ì˜¤í›„ 10:00'); 
                             endDateTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), endOfDayTime.hours, endOfDayTime.minutes);
                             if (startDateTime.getTime() + 60 * 60 * 1000 < endDateTime.getTime()) {
                                endDateTime = new Date(startDateTime.getTime() + 60 * 60 * 1000); 
                             }
                        } else {
                            // ì£¼ì¤‘ ë§ˆì§€ë§‰ í™œë™: 1ì‹œê°„ ì§€ì†ëœë‹¤ê³  ê°€ì •
                            endDateTime = new Date(startDateTime.getTime() + 60 * 60 * 1000); 
                        }
                    }
                    
                    // í˜„ì¬ ì‹œê°„ì´ í™œë™ ì‹œê°„ëŒ€ì— ì†í•˜ëŠ”ì§€ í™•ì¸
                    if (now >= startDateTime && now < endDateTime) {
                        currentActivityIndex = i; // í˜„ì¬ í™œë™ ì¸ë±ìŠ¤ ì €ì¥
                        foundCurrent = true;
                        break; // í˜„ì¬ í™œë™ì„ ì°¾ì•˜ìœ¼ë¯€ë¡œ ë” ì´ìƒ í™•ì¸í•  í•„ìš” ì—†ìŒ
                    }
                }

                if (foundCurrent) {
                    const scheduleElements = document.querySelectorAll('#schedule-content .timeline-item');
                    const currentActivityElement = Array.from(scheduleElements).find(el => parseInt(el.dataset.index) === currentActivityIndex);

                    if (currentActivityElement) {
                        currentActivityElement.classList.add('current-activity');
                        // í˜„ì¬ í™œë™ì„ ë·°ì˜ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                        currentActivityElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        // í˜„ì¬ í™œë™ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ìŒì„± ì•Œë¦¼
                        if (lastAnnouncedActivity !== currentSchedule[currentActivityIndex].activity) {
                            speak(`${currentSchedule[currentActivityIndex].activity} ì‹œì‘í•  ì‹œê°„ì´ì—ìš”.`);
                            lastAnnouncedActivity = currentSchedule[currentActivityIndex].activity;
                            console.log('ìŒì„± ì•Œë¦¼:', currentSchedule[currentActivityIndex].activity); // Debug: ìŒì„± ì•Œë¦¼ ë‚´ìš©
                        }
                        console.log('í˜„ì¬ í™œë™ ê°•ì¡° ë° ìŠ¤í¬ë¡¤ ì™„ë£Œ:', currentSchedule[currentActivityIndex].activity); // Debug: í˜„ì¬ í™œë™ í™•ì¸
                    } else {
                        console.warn('ê°•ì¡°í•  í˜„ì¬ í™œë™ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ (index:', currentActivityIndex, ')'); // Debug: ê°•ì¡° ìš”ì†Œ ì—†ìŒ ê²½ê³ 
                    }
                } else {
                    lastAnnouncedActivity = null; // í˜„ì¬ í™œë™ì´ ì—†ìœ¼ë©´ ì•Œë¦¼ ì¬ì„¤ì •
                    console.log('í˜„ì¬ ì‹œê°„ëŒ€ì— í•´ë‹¹í•˜ëŠ” í™œë™ì´ ì—†ìŒ.'); // Debug: í˜„ì¬ í™œë™ ì—†ìŒ
                }
            }

            function createScheduleItemHtml(item, day, index, isExploreView = false) {
                const borderColor = categoryBorders[item.category] || 'border-gray-200';
                // completedClassëŠ” íƒìƒ‰ ë·°ê°€ ì•„ë‹ ë•Œ (ì²´í¬ë°•ìŠ¤ ë¹„í™œì„± ì‹œ)ë§Œ ì ìš©
                const completedClass = item.completed && !isExploreView ? 'completed-activity' : ''; 
                // ì²´í¬ë°•ìŠ¤ëŠ” íƒìƒ‰ ë·°ê°€ ì•„ë‹ ë•Œë§Œ ë Œë”ë§
                const checkboxHtml = isExploreView ? '' : `<input type="checkbox" id="activity-${day}-${index}" class="activity-checkbox h-5 w-5 text-teal-600 border-gray-300 rounded focus:ring-teal-500" ${item.completed ? 'checked' : ''}>`;

                let iconContent;
                if(item.icon === 'ì”»ê¸°') { // 'ì”»ê¸°' ì•„ì´ì½˜ì— ëŒ€í•œ íŠ¹ì • SVG
                    iconContent = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#A4C3B2]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M12 6v2m0 8v2m-6.364-2.364l1.414-1.414M18.364 12l-1.414 1.414m-10.102-5.05l1.414 1.414M16.95 16.95l-1.414-1.414" /></svg>`;
                } else { // ê·¸ ì™¸ì—ëŠ” í‘œì¤€ í…ìŠ¤íŠ¸ ì•„ì´ì½˜
                    iconContent = `<span class="text-2xl text-[#A4C3B2]">${item.icon}</span>`;
                }

                return `
                    <div class="relative flex items-center gap-4 timeline-item border-l-4 ${borderColor} pl-6 pr-4 py-3 rounded-lg transition-all duration-300 ${completedClass}" data-index="${index}">
                        <div class="absolute -left-3.5 top-1/2 -translate-y-1/2 flex items-center justify-center w-8 h-8 rounded-full bg-white ring-4 ring-[#A4C3B2]">
                            ${iconContent}
                        </div>
                        ${checkboxHtml}
                        <div class="flex-1 activity-text">
                            <p class="text-sm text-gray-500">${item.time}</p>
                            <h3 class="font-bold text-lg text-gray-800">${item.activity}</h3>
                            <p class="text-gray-600 text-sm">${item.description}</p>
                        </div>
                    </div>
                `;
            }

            function renderSchedule(day) {
                scheduleContent.innerHTML = ''; // í˜„ì¬ ìŠ¤ì¼€ì¤„ ë‚´ìš© ì§€ìš°ê¸°
                const daySchedule = scheduleData[day];
                if (!daySchedule) return; // í•´ë‹¹ ìš”ì¼ì˜ ìŠ¤ì¼€ì¤„ì´ ì—†ìœ¼ë©´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ

                daySchedule.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.innerHTML = createScheduleItemHtml(item, day, index, false); // isExploreView = false (ë©”ì¸ ìŠ¤ì¼€ì¤„ìš©)
                    scheduleContent.appendChild(itemDiv.firstElementChild); // divë¥¼ ì¶”ê°€, ë¬¸ìì—´ ì•„ë‹˜

                    const checkbox = itemDiv.firstElementChild.querySelector(`#activity-${day}-${index}`);
                    if (checkbox) {
                        checkbox.addEventListener('change', (e) => {
                            item.completed = e.target.checked;
                            saveScheduleState(); // ë³€ê²½ ì‹œ ìƒíƒœ ì €ì¥
                            if (item.completed) {
                                itemDiv.firstElementChild.classList.add('completed-activity');
                                const rect = itemDiv.firstElementChild.getBoundingClientRect();
                                createFireworks(rect.left + rect.width / 2, rect.top + rect.height / 2);
                                playClapSound();
                            } else {
                                itemDiv.firstElementChild.classList.remove('completed-activity');
                            }
                            renderWeeklyChart(); // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ì£¼ê°„ ì°¨íŠ¸ ë° ìŠ¤í‹°ì»¤ ì—…ë°ì´íŠ¸
                        });
                    }
                });
                console.log(`'${day}' ìš”ì¼ ìŠ¤ì¼€ì¤„ (${daySchedule.length}ê°œ í•­ëª©) ë Œë”ë§ ì™„ë£Œ.`); // Debug: ìŠ¤ì¼€ì¤„ ë Œë”ë§ í™•ì¸
                updateCurrentActivityHighlight(); // ë Œë”ë§ í›„ í˜„ì¬ í™œë™ ê°•ì¡°
            }

            let activeExploreDay = null; // í˜„ì¬ ì—´ë ¤ìˆëŠ” íƒìƒ‰ ìš”ì¼ì„ ì¶”ì 

            function renderExploreSchedule(day) {
                // ì´ í•¨ìˆ˜ëŠ” í† ê¸€ë  ë•Œë§ˆë‹¤ í˜¸ì¶œë˜ë¯€ë¡œ, ë‚´ìš©ì„ ê·¸ë¦¬ê¸° ì „ì— ë¹„ì›Œì•¼ í•©ë‹ˆë‹¤.
                exploreScheduleContent.innerHTML = '';
                const daySchedule = scheduleData[day];

                if (!daySchedule || daySchedule.length === 0) {
                    const noScheduleMessage = document.createElement('p');
                    noScheduleMessage.className = 'text-center text-gray-500 py-8';
                    noScheduleMessage.textContent = `${day}ì—ëŠ” íŠ¹ë³„í•œ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.`;
                    exploreScheduleContent.appendChild(noScheduleMessage);
                    console.log(`íƒìƒ‰ ìŠ¤ì¼€ì¤„: '${day}' ìš”ì¼ (í•­ëª© ì—†ìŒ).`); // Debug
                } else {
                    daySchedule.forEach((item, index) => {
                        const itemDiv = document.createElement('div');
                        itemDiv.innerHTML = createScheduleItemHtml(item, day, index, true); // isExploreView = true
                        exploreScheduleContent.appendChild(itemDiv.firstElementChild);
                    });
                    console.log(`íƒìƒ‰ ìŠ¤ì¼€ì¤„: '${day}' ìš”ì¼ (${daySchedule.length}ê°œ í•­ëª©) ë Œë”ë§ ì™„ë£Œ.`); // Debug
                }
                currentExploredDay = day; 
                renderDailyChart(currentExploredDay); 
            }

            function renderTabs() {
                console.log('íƒ­ ë Œë”ë§ ì‹œì‘...'); // Debug 6
                const days = Object.keys(scheduleData);
                console.log('ìŠ¤ì¼€ì¤„ ë°ì´í„°ì˜ ìš”ì¼ ëª©ë¡:', days); // Debug 7

                const todayIndex = new Date().getDay();
                const daysMap = {'ì›”': 1, 'í™”': 2, 'ìˆ˜': 3, 'ëª©': 4, 'ê¸ˆ': 5, 'ì£¼ë§': (todayIndex === 0 || todayIndex === 6) ? todayIndex : null};
                
                let initialDayToRender = 'ì›”'; 
                for (const dayName in daysMap) {
                    if (daysMap[dayName] === todayIndex) {
                        initialDayToRender = dayName;
                        break;
                    } else if (dayName === 'ì£¼ë§' && (todayIndex === 0 || todayIndex === 6)) {
                        initialDayToRender = 'ì£¼ë§';
                        break;
                    }
                }
                currentActiveDay = initialDayToRender; // ì™¼ìª½ íŒ¨ë„ì˜ ì´ˆê¸° í™œì„± ìš”ì¼ ì„¤ì •

                // ì™¼ìª½ íŒ¨ë„ ('ì˜¤ëŠ˜ì˜ ì¼ì •') íƒ­ ë Œë”ë§
                if (!dayTabsContainer) {
                    console.error("ì˜¤ë¥˜: ID 'day-tabs'ë¥¼ ê°€ì§„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"); // Debug 8
                    return; 
                }
                dayTabsContainer.innerHTML = '';
                days.forEach(day => {
                    const tabButton = document.createElement('button');
                    tabButton.textContent = day;
                    tabButton.className = `px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${day === initialDayToRender ? 'tab-active' : 'tab-inactive'}`;
                    tabButton.addEventListener('click', () => {
                        document.querySelectorAll('#day-tabs button').forEach(btn => btn.classList.replace('tab-active', 'tab-inactive'));
                        tabButton.classList.replace('tab-inactive', 'tab-active');
                        currentActiveDay = day; 
                        renderSchedule(day); 
                    });
                    dayTabsContainer.appendChild(tabButton);
                });
                console.log('ì™¼ìª½ ìš”ì¼ íƒ­ ë Œë”ë§ ì™„ë£Œ.'); // Debug 10

                // ì˜¤ë¥¸ìª½ íŒ¨ë„ ('ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„ íƒìƒ‰') íƒ­ ë Œë”ë§
                if (!exploreDayTabsContainer) {
                    console.error("ì˜¤ë¥˜: ID 'explore-day-tabs'ë¥¼ ê°€ì§„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"); // Debug 9
                    return; 
                }
                exploreDayTabsContainer.innerHTML = '';
                days.forEach(day => {
                    const tabButton = document.createElement('button');
                    tabButton.textContent = day;
                    tabButton.className = `px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 tab-inactive`; // ëª¨ë“  íƒ­ì„ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„± ìƒíƒœë¡œ ì‹œì‘
                    
                    tabButton.addEventListener('click', () => {
                        // í˜„ì¬ í´ë¦­ëœ ìš”ì¼ì´ ì´ë¯¸ í™œì„±í™”ëœ íƒìƒ‰ ìš”ì¼ì¸ ê²½ìš°
                        if (activeExploreDay === day) {
                            exploreScheduleContent.classList.add('hidden'); // ë‚´ìš©ì„ ìˆ¨ê¹€
                            tabButton.classList.replace('tab-active', 'tab-inactive'); // ë²„íŠ¼ ë¹„í™œì„±
                            activeExploreDay = null; // í™œì„± íƒìƒ‰ ìš”ì¼ ì¬ì„¤ì •
                        } else {
                            // ë‹¤ë¥¸ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ë¹„í™œì„±í™”
                            document.querySelectorAll('#explore-day-tabs button').forEach(btn => {
                                btn.classList.replace('tab-active', 'tab-inactive');
                            });
                            // ìƒˆë¡œ í´ë¦­ëœ íƒ­ í™œì„±í™”
                            tabButton.classList.replace('tab-inactive', 'tab-active');
                            exploreScheduleContent.classList.remove('hidden'); // ë‚´ìš©ì„ ë³´ì´ê²Œ í•¨
                            activeExploreDay = day; // í™œì„± íƒìƒ‰ ìš”ì¼ ì„¤ì •
                            renderExploreSchedule(day); // í•´ë‹¹ ìš”ì¼ì˜ ìŠ¤ì¼€ì¤„ ë Œë”ë§
                        }
                    });
                    exploreDayTabsContainer.appendChild(tabButton);
                });
                console.log('ì˜¤ë¥¸ìª½ íƒìƒ‰ ìš”ì¼ íƒ­ ë Œë”ë§ ì™„ë£Œ.'); // Debug 11
            }
            
            // 'ìŠ¤ì¼€ì¤„ ìš´ì˜ Tip' ê´€ë ¨ í•¨ìˆ˜ ì œê±°ë¨

            // --- Charting Functions ---

            function getWeeklyActivityDurations() {
                const weeklyActivityDurations = { 
                    'ì¹˜ë£Œ': (3 * 60) + (1 * 60), // ì£¼ì¤‘ 3ì‹œê°„ (ìˆ˜, ëª©) + ì£¼ë§ 1ì‹œê°„ (ì£¼ë§ ì˜¤í›„ 2ì‹œ í™œë™) = 4ì‹œê°„
                    'í•™ìŠµ': (0.5 * 2) * 60 + (0.5 * 60), // ì£¼ì¤‘ 1ì‹œê°„ (ì›”, ìˆ˜) + ì£¼ë§ 0.5ì‹œê°„ = 1.5ì‹œê°„
                    'ë…ì„œ': (0.5 * 2 + 0.45) * 60 + (0.5 * 60), // ì£¼ì¤‘ 1.75ì‹œê°„ (ì›”, ìˆ˜, ê¸ˆ) + ì£¼ë§ 0.5ì‹œê°„ = 2.25ì‹œê°„
                    'ë†€ì´': (1.5 + 1.5 + 1 + 1 + 1) * 60 + (1 * 60 + 1 * 60 + 1.5 * 60), // ì›” 1.5, í™” 1.5, ìˆ˜ 1, ëª© 1, ê¸ˆ 1 + ì£¼ë§ ììœ  (ì˜¤ì „ 11:30, ì˜¤í›„ 3:00, ì˜¤í›„ 5:00) = 6ì‹œê°„ + 3.5ì‹œê°„ = 9.5ì‹œê°„
                    'íœ´ì‹': (1.5 + 1.5 + 0.5 + 1) * 60 + (0.5 * 60), // ì›” 1.5, í™” 1.5, ìˆ˜ 0.5, ëª© 1 + ì£¼ë§ íœ´ì‹(ì˜¤í›„ 8ì‹œ) 0.5ì‹œê°„ = 4.5ì‹œê°„ + 0.5ì‹œê°„ = 5ì‹œê°„
                    'ê¸°ë³¸ìƒí™œ': (0.5 * 5) * 60 + (0.5 * 4 * 60), // ì£¼ì¤‘ 2.5ì‹œê°„ (ì €ë… ì‹ì‚¬, ì·¨ì¹¨ ì¤€ë¹„) + ì£¼ë§ 2ì‹œê°„ (ì•„ì¹¨, ì ì‹¬, ì €ë…, ì·¨ì¹¨ì¤€ë¹„) = 4.5ì‹œê°„
                    'ì™¸ë¶€ìˆ˜ì—…': (1 * 2) * 60 // í™” 1ì‹œê°„, ëª© 1ì‹œê°„ = 2ì‹œê°„
                };
                return weeklyActivityDurations;
            }

            function renderWeeklyChart() {
                const ctx = document.getElementById('weeklyActivityChart').getContext('2d');
                const weeklyActivityDurations = getWeeklyActivityDurations();
                const labels = Object.keys(weeklyActivityDurations);
                const data = Object.values(weeklyActivityDurations).map(minutes => parseFloat((minutes / 60).toFixed(1))); // Convert minutes to hours and round

                if (weeklyActivityChart) {
                    weeklyActivityChart.destroy(); // Destroy existing chart before creating a new one
                }

                weeklyActivityChart = new Chart(ctx, {
                    type: 'bar', // Change to bar chart
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ì£¼ê°„ í™œë™ ì‹œê°„ (ì‹œê°„)',
                            data: data,
                            backgroundColor: Object.values(categoryColors),
                            borderColor: '#FDFBF8',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ì‹œê°„ (ì‹œ)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'í™œë™ ìœ í˜•'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false // Bar chart doesn't need separate legend for single dataset
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += `${context.parsed.y} ì‹œê°„`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

                // Calculate and display praise stickers
                calculatePraiseStickers();
            }

            function getDailyCategoryDurations(day) {
                const daySchedule = scheduleData[day];
                const durations = {};
                if (!daySchedule) return durations;

                for (const category in categoryColors) {
                    durations[category] = 0;
                }

                for (let i = 0; i < daySchedule.length; i++) {
                    const currentItem = daySchedule[i];
                    let durationMinutes = 0;

                    if (!currentItem.time.includes('ì˜¤ì „') && !currentItem.time.includes('ì˜¤í›„')) {
                        durationMinutes = 30; // Default to 30 mins for non-specific times
                    } else if (i + 1 < daySchedule.length) {
                        const startTime = parseTime(currentItem.time);
                        const nextItem = daySchedule[i+1];
                        if (nextItem.time.includes('ì˜¤ì „') || nextItem.time.includes('ì˜¤í›„')) {
                             const nextStartTime = parseTime(nextItem.time);
                             const currentTotalMinutes = startTime.hours * 60 + startTime.minutes;
                             const nextTotalMinutes = nextStartTime.hours * 60 + nextStartTime.minutes; 
                             durationMinutes = nextTotalMinutes - currentTotalMinutes;
                             if (durationMinutes < 0) { // If crossing midnight (not common in this schedule but for robustness)
                                 durationMinutes += 24 * 60;
                             }
                        } else {
                            durationMinutes = 60; // Assume 1 hour if next time is non-specific
                        }
                    } else {
                        // Last activity of the day: assume it lasts 1 hour or until bedtime (22:00)
                        const startTime = parseTime(currentItem.time);
                        const bedTime = parseTime('ì˜¤í›„ 10:00'); 
                        const startTotalMinutes = startTime.hours * 60 + startTime.minutes;
                        const bedTotalMinutes = bedTime.hours * 60 + bedTime.minutes;
                        
                        durationMinutes = Math.max(60, bedTotalMinutes - startTotalMinutes); // At least 1 hour, or until 10 PM
                    }
                    
                    if (durations[currentItem.category] !== undefined) {
                        durations[currentItem.category] += durationMinutes;
                    }
                }

                return durations;
            }

            function renderDailyChart(day) {
                const ctx = document.getElementById('dailyActivityChart').getContext('2d');
                document.getElementById('daily-analysis-day-desc').textContent = `${day} í™œë™ë“¤ì˜ êµ¬ì„± ë¹„ìœ¨ì„ í¼ì„¼íŠ¸ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.`;

                const dailyDurations = getDailyCategoryDurations(day);
                const labels = Object.keys(dailyDurations);
                const data = Object.values(dailyDurations);

                const totalMinutes = data.reduce((sum, current) => sum + current, 0);
                const percentageData = data.map(minutes => totalMinutes > 0 ? parseFloat((minutes / totalMinutes * 100).toFixed(1)) : 0);

                if (dailyActivityChart) {
                    dailyActivityChart.destroy(); // Destroy existing chart before creating a new one
                }

                dailyActivityChart = new Chart(ctx, {
                    type: 'bar', 
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `${day} í™œë™ ë¹„ìœ¨ (%)`,
                            data: percentageData,
                            backgroundColor: Object.values(categoryColors),
                            borderColor: '#FDFBF8',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100, 
                                title: {
                                    display: true,
                                    text: 'ë¹„ìœ¨ (%)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'í™œë™ ìœ í˜•'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += `${context.parsed.y}%`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            function calculatePraiseStickers() {
                let totalActivities = 0;
                let completedActivities = 0;

                for (const day in scheduleData) {
                    scheduleData[day].forEach(activity => {
                        totalActivities++;
                        if (activity.completed) {
                            completedActivities++;
                        }
                    });
                }

                const completionPercentage = totalActivities > 0 ? (completedActivities / totalActivities * 100) : 0;
                let stickerCount = 0;

                if (completionPercentage >= 80) {
                    stickerCount = 5;
                } else if (completionPercentage >= 60) {
                    stickerCount = 3;
                } else if (completionPercentage >= 40) {
                    stickerCount = 1;
                } else {
                    stickerCount = 0;
                }

                document.getElementById('total-activities-count-weekly').textContent = totalActivities;
                document.getElementById('completed-activities-count-weekly').textContent = completedActivities;
                document.getElementById('sticker-count-weekly').textContent = stickerCount;
            }

            // Initial load sequence
            console.log('ì´ˆê¸° ë¡œë“œ ì‹œí€€ìŠ¤ ì‹œì‘...'); // Debug 12
            loadScheduleState(); 
            setupAudio(); 
            renderTabs(); 
            renderSchedule(currentActiveDay); 
            // `exploreScheduleContent`ë¥¼ ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ ìƒíƒœë¡œ ì‹œì‘
            exploreScheduleContent.classList.add('hidden'); 
            renderWeeklyChart(); 
            console.log('ì´ˆê¸° ë¡œë“œ ì‹œí€€ìŠ¤ ì™„ë£Œ.'); // Debug 13

            // Analysis Tab Switching
            weeklyAnalysisTab.addEventListener('click', () => {
                weeklyAnalysisTab.classList.replace('analysis-tab-inactive', 'analysis-tab-active');
                dailyAnalysisTab.classList.replace('analysis-tab-active', 'analysis-tab-inactive');
                weeklyAnalysisContent.classList.remove('hidden');
                dailyAnalysisContent.classList.add('hidden');
                renderWeeklyChart(); 
            });

            dailyAnalysisTab.addEventListener('click', () => {
                dailyAnalysisTab.classList.replace('analysis-tab-inactive', 'analysis-tab-active');
                weeklyAnalysisTab.classList.replace('analysis-tab-active', 'analysis-tab-inactive');
                dailyAnalysisContent.classList.remove('hidden');
                weeklyAnalysisContent.classList.add('hidden');
                // Daily chartëŠ” í™œì„±í™”ëœ ìš”ì¼ë¡œ ë Œë”ë§
                // `currentExploredDay`ê°€ nullì¸ ê²½ìš° ê¸°ë³¸ ìš”ì¼ (ì›”) ì‚¬ìš©
                renderDailyChart(currentExploredDay || 'ì›”'); 
            });
            
            // Set up interval for real-time highlighting and voice notification
            setInterval(updateCurrentActivityHighlight, 60 * 1000); 
        });
    </script>
</body>
</html>
